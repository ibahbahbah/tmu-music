import{r,j as t,a as j}from"./app-d575b866.js";import{A as v}from"./AuthenticatedLayout-5a4a9f5d.js";import{d as w}from"./index-82529175.js";import N from"./PostList-8e79cf84.js";import"./transition-1a053668.js";import"./tmusiclogo-591b3884.js";import"./PostItem-7e945bc5.js";function z({auth:d,posts:u,spotify:S}){const[a,h]=r.useState(""),[m,E]=r.useState(""),[n,l]=r.useState([]),[o,p]=r.useState(null),[x,f]=r.useState(null);r.useEffect(()=>{const e=localStorage.getItem("spotifyAccessToken"),s=localStorage.getItem("spotifyTokenExpiry");!e||new Date>parseInt(s)?window.location.href="/authorize-spotify":b(e)},[m]);const b=async e=>{try{const s=await fetch("https://api.spotify.com/v1/me",{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Failed to fetch Spotify user profile");const i=await s.json();f(i)}catch(s){console.error("Error fetching Spotify user profile:",s)}},c=async()=>{if(!a.trim())return;const e=localStorage.getItem("spotifyAccessToken");try{const i=await(await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(a)}&type=track`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).json();l(i.tracks.items)}catch(s){console.error("Error fetching data:",s)}};r.useEffect(()=>{a!==""&&c()},[a,m]),r.useEffect(()=>{a===""&&l([])},[a]);const g=e=>{p({title:e.name,album:e.album.name,artist:e.artists.map(s=>s.name).join(", "),album_cover:e.album.images[0].url,user:d.user,preview_url:e.preview_url,description:""}),l([])},y=e=>{e.preventDefault(),w.Inertia.post("/posts",o).then(()=>{window.location.reload()})};return t.jsxs(v,{user:d.user,children:[t.jsx(j,{title:"Dashboard"}),t.jsx("div",{className:"container mx-auto px-8 py-8 ",children:t.jsxs("div",{className:"relative",children:[t.jsx("input",{className:"rounded-md border-2 border-gray-300 w-1/2 mr-2",placeholder:"Post a Song",type:"text",onKeyPress:e=>{e.key==="Enter"&&c()},onChange:e=>h(e.target.value)}),t.jsx("button",{className:"bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-4 rounded",onClick:()=>{c()},children:"Search"})]})}),n.length>0&&t.jsx("div",{className:"container mx-auto px-4 mb-8 p-4",children:t.jsx("div",{className:"grid grid-cols-4 gap-4 mx-2 overflow-y-auto h-auto md:h-96 sm:h-40",children:n&&n.map((e,s)=>t.jsxs("div",{className:"bg-white rounded-lg max-w-xs shadow-lg cursor-pointer",onClick:()=>g(e),children:[t.jsx("img",{className:"w-full object-cover",src:e.album.images[0].url,alt:e.name}),t.jsxs("div",{className:"px-4 py-2",children:[t.jsx("div",{className:"font-bold text-black text-l mb-1 line-clamp-1",children:e.name}),t.jsx("div",{className:"text-gray-600 text-sm line-clamp-1",children:e.artists.map(i=>i.name).join(", ")})]})]},s))})}),o&&t.jsx("div",{className:"container mx-auto px-4 mb-8",children:t.jsxs("div",{className:"max-w-xl mx-auto bg-white rounded-lg overflow-hidden shadow-lg relative mb-4 grid grid-cols-12",children:[t.jsx("div",{className:"col-span-8 p-4 flex flex-col justify-between",children:t.jsxs("form",{onSubmit:y,children:[t.jsx("div",{className:"text-xl font-bold",children:o.title}),t.jsxs("div",{className:"text-md mb-2 text-gray-500",children:[" ","by"," ",t.jsx("span",{className:"font-bold",children:o.artist})]}),t.jsx("textarea",{className:"text-sm border-2 border-gray-300 w-full p-2 mb-2 rounded-lg",placeholder:"Type your description here",value:o.description,onChange:e=>p({...o,description:e.target.value}),style:{resize:"none",height:"80px"}}),t.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white text-sm font-bold py-1 px-2 rounded",children:"Submit"})]})}),t.jsx("div",{className:"col-span-4",children:t.jsx("img",{className:"w-full h-full object-cover",src:o.album_cover,alt:o.title})})]})}),t.jsx(N,{posts:u,spotifyUserProfile:x})]})}export{z as default};
